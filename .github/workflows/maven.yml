name: Maven

on: [push]

jobs:
  build:
    name: Build with Java 8
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-java@v1
        with:
          java-version: 1.8
      - run: java -version
      - run: mvn --version
      - run: mvn -B package

  deploy:
    name: Deploy with Java 8
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-java@v1
        with:
          java-version: 1.8
      - run: java -version
      - run: mvn --version
      - run: |
          mkdir -pv ~/.ssh
          touch ~/.ssh/id_rsa
          chmod -c 600 ~/.ssh/id_rsa
          echo "${{ secrets.MAVEN_REPO_KEY }}" > ~/.ssh/id_rsa
          git config --global user.email "null@azisaba.net"
          git config --global user.name "$GITHUB_ACTOR"
      - run: git clone git@github.com:AzisabaNetwork/mvn-repo.git
      - run: mvn -B -DaltDeploymentRepository=local::default::file://mvn-repo deploy
      - run: |
          cd mvn-repo
          git add -A
          git commit -m "Deploy @ $(date)"
          git push origin master
